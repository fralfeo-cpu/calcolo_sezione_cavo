<!DOCTYPE html>
<html lang="it">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CableSizer Pro - CEI 64-8</title>
    <link rel="stylesheet" href="style.css">
    <link rel="manifest" href="manifest.json">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <!-- jsPDF -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</head>

<body>
    <header>
        <div class="logo">
            <i data-lucide="zap"></i>
            <span>CableSizer Pro</span>
        </div>
        <button id="theme-toggle" class="icon-btn">
            <i data-lucide="moon"></i>
        </button>
    </header>

    <main id="app-container">
        <!-- SEZIONE 1: Dimensionamento Completo -->
        <section id="sec-sizing" class="active-section">
            <h2 class="section-title"><i data-lucide="calculator"></i> Dimensionamento Cavo</h2>

            <div class="card">
                <div class="grid">
                    <div class="form-group">
                        <label>Sistema</label>
                        <div class="toggle-group" id="sys-toggle">
                            <button class="toggle-btn active" data-val="mono">Monofase</button>
                            <button class="toggle-btn" data-val="tri">Trifase</button>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Tensione (V)</label>
                        <input type="number" id="input-v" value="230">
                    </div>
                    <div class="form-group">
                        <label>Ingresso Carico</label>
                        <div class="toggle-group" id="load-toggle">
                            <button class="toggle-btn active" data-val="ib">Ib (A)</button>
                            <button class="toggle-btn" data-val="p">P (kW)</button>
                        </div>
                    </div>
                    <div class="form-group" id="group-load">
                        <label id="label-load">Corrente Ib (A)</label>
                        <input type="number" id="input-load" placeholder="Es. 16">
                    </div>
                    <div class="form-group hidden" id="group-cosphi">
                        <label>cos φ</label>
                        <input type="number" id="input-cosphi" value="0.9" step="0.05" min="0" max="1">
                    </div>
                    <div class="form-group">
                        <label>Lunghezza (m)</label>
                        <input type="number" id="input-l" placeholder="Es. 50">
                    </div>
                    <div class="form-group">
                        <label>Materiale</label>
                        <div class="toggle-group" id="mat-toggle">
                            <button class="toggle-btn active" data-val="rame">Rame</button>
                            <button class="toggle-btn" data-val="alluminio">Alluminio</button>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>ΔV max (%)</label>
                        <input type="number" id="input-dvmax" value="4" step="0.1">
                    </div>
                </div>
            </div>

            <div class="card">
                <h3 class="section-title" style="font-size: 1rem;"><i data-lucide="info"></i> Posa e Fattori K</h3>
                <div class="grid">
                    <div class="form-group">
                        <label>Tipo di Posa (CEI 64-8)</label>
                        <select id="select-posa">
                            <optgroup label="In Aria">
                                <option value="A1">A1: In tubo entro muro isolante</option>
                                <option value="A2">A2: Multi in tubo entro muro isolante</option>
                                <option value="B1">B1: Uni in tubo su muro/incassato</option>
                                <option value="B2">B2: Multi in tubo su muro/incassato</option>
                                <option value="C" selected>C: A parete o passerella non perf.</option>
                                <option value="E">E: Multi su passerella perforata</option>
                                <option value="F">F: Uni a contatto su pass. perf.</option>
                                <option value="G">G: Uni distanziati in aria</option>
                            </optgroup>
                            <optgroup label="Interrata">
                                <option value="D1">D1: In condotti interrati</option>
                                <option value="D2">D2: Direttamente interrato</option>
                            </optgroup>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Isolamento</label>
                        <select id="select-iso">
                            <option value="PVC">PVC (70°C)</option>
                            <option value="EPR">EPR/XLPE (90°C)</option>
                        </select>
                    </div>
                    <div id="k-factors-container" class="grid" style="grid-column: 1 / -1;">
                        <!-- Dinamico via JS -->
                    </div>
                </div>
            </div>

            <div id="results-card" class="card hidden">
                <h3 class="section-title" style="font-size: 1.1rem;"><i data-lucide="check-circle-2"></i> Risultati
                    Calcolo</h3>
                <div class="results-panel">
                    <div class="result-item">
                        <span>Corrente di Impiego (Ib):</span>
                        <span class="result-value" id="res-ib">- A</span>
                    </div>
                    <div class="result-item">
                        <span>Sezione Ottimale:</span>
                        <span class="result-value" id="res-section">- mm²</span>
                    </div>
                    <div class="result-item">
                        <span>Portata Reale (Iz):</span>
                        <span class="result-value" id="res-iz">- A</span>
                    </div>
                    <div class="result-item">
                        <span>Caduta Tensione (ΔV%):</span>
                        <span class="result-value" id="res-dv">- %</span>
                    </div>
                    <div class="dv-bar-container">
                        <div id="dv-bar" class="dv-bar"></div>
                    </div>
                </div>
                <button id="btn-save" class="btn-primary" style="margin-top: 2rem;">
                    <i data-lucide="save"></i> Salva Progetto
                </button>
            </div>
        </section>

        <!-- SEZIONE 2: Solo ΔV -->
        <section id="sec-dv" class="hidden">
            <h2 class="section-title"><i data-lucide="zap"></i> Calcolo Rapido ΔV</h2>
            <div class="card">
                <!-- Simile a Section 1 ma semplificato -->
                <p style="color:var(--on-surface-variant)">Calcolo isolato per verifiche rapide di caduta tensione su
                    sezioni note.</p>
                <div id="dv-quick-container" class="grid" style="margin-top:1rem">
                    <!-- Dinamico -->
                </div>
            </div>
        </section>

        <!-- SEZIONE 3: Tabelle -->
        <section id="sec-tables" class="hidden">
            <h2 class="section-title"><i data-lucide="table"></i> Tabelle Normative</h2>
            <div class="toggle-group" style="margin-bottom: 1rem;">
                <button class="toggle-btn active" data-tab="tab-aria">In Aria</button>
                <button class="toggle-btn" data-tab="tab-terra">Interrata</button>
            </div>
            <div id="tables-container">
                <!-- Tabelle popolate dal JSON via JS -->
            </div>
        </section>

        <!-- SEZIONE 4: Archivio -->
        <section id="sec-archive" class="hidden">
            <h2 class="section-title"><i data-lucide="folder"></i> Archivio Progetti</h2>
            <div id="archive-list">
                <!-- Card dei progetti -->
                <p id="empty-msg" style="text-align:center; padding: 2rem; color: var(--on-surface-variant)">Nessun
                    progetto salvato.</p>
            </div>
        </section>
    </main>

    <nav>
        <button class="nav-item active" data-sec="sec-sizing">
            <i data-lucide="bolt"></i>
            <span>Dimensionamento</span>
        </button>
        <button class="nav-item" data-sec="sec-dv">
            <i data-lucide="activity"></i>
            <span>Solo ΔV</span>
        </button>
        <button class="nav-item" data-sec="sec-tables">
            <i data-lucide="table"></i>
            <span>Tabelle</span>
        </button>
        <button class="nav-item" data-sec="sec-archive">
            <i data-lucide="history"></i>
            <span>Archivio</span>
        </button>
    </nav>

    <script src="db.js"></script>
    <script src="app.js"></script>
</body>

</html>